<!DOCTYPE html>
<html>
<head>
<title>TabBack</title>
<script>
  /* Key Pressed/Released Array */
  var keys = [];
  /* Tabs Closed */
  var tabStack = new Array();
  /* Flag for whether a tab has been opened since last t-keyUp */
  var flag = false;

	window.addEventListener("keydown", keyPressed, false);
	window.addEventListener("keyup", keyReleased, false);

  /* Key Press Handler */
  function keyPressed(e) {
    console.log("Pressed key with keycode: " + e.keyCode);
    keys[e.keyCode] = true;
    if ((keys[91] || keys[93]) && keys[16] && keys[84] && !flag) {
      flag = !flag;
    }
  }

  /* Key Release Handler */
   function keyReleased(e) {
    keys[e.keyCode] = false;
    if (!keys[84] && flag) {
      flag = !flag;
    }
  }

  /* Tab Close event handler */
	function closeHandler() {
	  var url = safari.application.activeBrowserWindow.activeTab.url;
	  if (url != undefined) {
      tabStack.push(url);
    }
  }
  
  /* Override event listeners, define custom handlers */
	safari.application.addEventListener("close", closeHandler, true);
</script>
</head>
</html>
